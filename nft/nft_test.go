package nft

import (
	"encoding/hex"
	"reflect"
	"testing"
)

var (
	nCeption1_svg = `<svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin meet" viewBox="0 0 350 350"><style>.base { fill: white; font-family: serif; font-size: 14px; }</style><rect width="100%" height="100%" fill="black" /><text x="10" y="20" class="base">9</text><text x="10" y="40" class="base">10</text><text x="10" y="60" class="base">6</text><text x="10" y="80" class="base">6</text><text x="10" y="100" class="base">6</text><text x="10" y="120" class="base">3</text><text x="10" y="140" class="base">3</text><text x="10" y="160" class="base">5</text></svg>`
	chimp1_svg    = `
	<svg xmlns="http://www.w3.org/2000/svg" version="1.1" shape-rendering="crispEdges" viewBox="0 0 16 16"><rect width="1.5" height="1.5" x="0" y="0" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="0" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="2" y="0" fill="#000000" /><rect width="1.5" height="1.5" x="3" y="0" fill="#0B53D7" /><rect width="1.5" height="1.5" x="4" y="0" fill="#000000" /><rect width="1.5" height="1.5" x="5" y="0" fill="#000000" /><rect width="1.5" height="1.5" x="6" y="0" fill="#0B53D7" /><rect width="1.5" height="1.5" x="7" y="0" fill="#0B53D7" /><rect width="1.5" height="1.5" x="8" y="0" fill="#0B53D7" /><rect width="1.5" height="1.5" x="9" y="0" fill="#0B53D7" /><rect width="1.5" height="1.5" x="10" y="0" fill="#0B53D7" /><rect width="1.5" height="1.5" x="11" y="0" fill="#0B53D7" /><rect width="1.5" height="1.5" x="12" y="0" fill="#0B53D7" /><rect width="1.5" height="1.5" x="13" y="0" fill="#0B53D7" /><rect width="1.5" height="1.5" x="14" y="0" fill="#0B53D7" /><rect width="1.5" height="1.5" x="15" y="0" fill="#0B53D7" /><rect width="1.5" height="1.5" x="0" y="1" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="1" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="2" y="1" fill="#000000" /><rect width="1.5" height="1.5" x="3" y="1" fill="#0B53D7" /><rect width="1.5" height="1.5" x="4" y="1" fill="#0B53D7" /><rect width="1.5" height="1.5" x="5" y="1" fill="#0B53D7" /><rect width="1.5" height="1.5" x="6" y="1" fill="#0B53D7" /><rect width="1.5" height="1.5" x="7" y="1" fill="#0B53D7" /><rect width="1.5" height="1.5" x="8" y="1" fill="#0B53D7" /><rect width="1.5" height="1.5" x="9" y="1" fill="#0B53D7" /><rect width="1.5" height="1.5" x="10" y="1" fill="#F4D199" /><rect width="1.5" height="1.5" x="11" y="1" fill="#000000" /><rect width="1.5" height="1.5" x="12" y="1" fill="#0B53D7" /><rect width="1.5" height="1.5" x="13" y="1" fill="#0B53D7" /><rect width="1.5" height="1.5" x="14" y="1" fill="#0B53D7" /><rect width="1.5" height="1.5" x="15" y="1" fill="#0B53D7" /><rect width="1.5" height="1.5" x="0" y="2" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="2" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="2" y="2" fill="#000000" /><rect width="1.5" height="1.5" x="3" y="2" fill="#0B53D7" /><rect width="1.5" height="1.5" x="4" y="2" fill="#0B53D7" /><rect width="1.5" height="1.5" x="5" y="2" fill="#0B53D7" /><rect width="1.5" height="1.5" x="6" y="2" fill="#0B53D7" /><rect width="1.5" height="1.5" x="7" y="2" fill="#0B53D7" /><rect width="1.5" height="1.5" x="8" y="2" fill="#0B53D7" /><rect width="1.5" height="1.5" x="9" y="2" fill="#F4D199" /><rect width="1.5" height="1.5" x="10" y="2" fill="#F4D199" /><rect width="1.5" height="1.5" x="11" y="2" fill="#000000" /><rect width="1.5" height="1.5" x="12" y="2" fill="#0B53D7" /><rect width="1.5" height="1.5" x="13" y="2" fill="#0B53D7" /><rect width="1.5" height="1.5" x="14" y="2" fill="#0B53D7" /><rect width="1.5" height="1.5" x="15" y="2" fill="#000000" /><rect width="1.5" height="1.5" x="0" y="3" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="3" fill="#000000" /><rect width="1.5" height="1.5" x="2" y="3" fill="#0B53D7" /><rect width="1.5" height="1.5" x="3" y="3" fill="#0B53D7" /><rect width="1.5" height="1.5" x="4" y="3" fill="#0B53D7" /><rect width="1.5" height="1.5" x="5" y="3" fill="#0B53D7" /><rect width="1.5" height="1.5" x="6" y="3" fill="#0B53D7" /><rect width="1.5" height="1.5" x="7" y="3" fill="#0B53D7" /><rect width="1.5" height="1.5" x="8" y="3" fill="#0B53D7" /><rect width="1.5" height="1.5" x="9" y="3" fill="#0B53D7" /><rect width="1.5" height="1.5" x="10" y="3" fill="#F4D199" /><rect width="1.5" height="1.5" x="11" y="3" fill="#000000" /><rect width="1.5" height="1.5" x="12" y="3" fill="#0B53D7" /><rect width="1.5" height="1.5" x="13" y="3" fill="#0B53D7" /><rect width="1.5" height="1.5" x="14" y="3" fill="#000000" /><rect width="1.5" height="1.5" x="15" y="3" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="0" y="4" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="4" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="2" y="4" fill="#0B53D7" /><rect width="1.5" height="1.5" x="3" y="4" fill="#0B53D7" /><rect width="1.5" height="1.5" x="4" y="4" fill="#0B53D7" /><rect width="1.5" height="1.5" x="5" y="4" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="6" y="4" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="7" y="4" fill="#0B53D7" /><rect width="1.5" height="1.5" x="8" y="4" fill="#0B53D7" /><rect width="1.5" height="1.5" x="9" y="4" fill="#0B53D7" /><rect width="1.5" height="1.5" x="10" y="4" fill="#0B53D7" /><rect width="1.5" height="1.5" x="11" y="4" fill="#0B53D7" /><rect width="1.5" height="1.5" x="12" y="4" fill="#0B53D7" /><rect width="1.5" height="1.5" x="13" y="4" fill="#000000" /><rect width="1.5" height="1.5" x="14" y="4" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="15" y="4" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="0" y="5" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="5" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="2" y="5" fill="#0B53D7" /><rect width="1.5" height="1.5" x="3" y="5" fill="#0B53D7" /><rect width="1.5" height="1.5" x="4" y="5" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="5" y="5" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="6" y="5" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="7" y="5" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="8" y="5" fill="#0B53D7" /><rect width="1.5" height="1.5" x="9" y="5" fill="#0B53D7" /><rect width="1.5" height="1.5" x="10" y="5" fill="#0B53D7" /><rect width="1.5" height="1.5" x="11" y="5" fill="#0B53D7" /><rect width="1.5" height="1.5" x="12" y="5" fill="#0B53D7" /><rect width="1.5" height="1.5" x="13" y="5" fill="#0B53D7" /><rect width="1.5" height="1.5" x="14" y="5" fill="#000000" /><rect width="1.5" height="1.5" x="15" y="5" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="0" y="6" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="6" fill="#000000" /><rect width="1.5" height="1.5" x="2" y="6" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="3" y="6" fill="#0B53D7" /><rect width="1.5" height="1.5" x="4" y="6" fill="#000000" /><rect width="1.5" height="1.5" x="5" y="6" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="6" y="6" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="7" y="6" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="8" y="6" fill="#0B53D7" /><rect width="1.5" height="1.5" x="9" y="6" fill="#0B53D7" /><rect width="1.5" height="1.5" x="10" y="6" fill="#0B53D7" /><rect width="1.5" height="1.5" x="11" y="6" fill="#0B53D7" /><rect width="1.5" height="1.5" x="12" y="6" fill="#0B53D7" /><rect width="1.5" height="1.5" x="13" y="6" fill="#0B53D7" /><rect width="1.5" height="1.5" x="14" y="6" fill="#0B53D7" /><rect width="1.5" height="1.5" x="15" y="6" fill="#000000" /><rect width="1.5" height="1.5" x="0" y="7" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="7" fill="#000000" /><rect width="1.5" height="1.5" x="2" y="7" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="3" y="7" fill="#0B53D7" /><rect width="1.5" height="1.5" x="4" y="7" fill="#000000" /><rect width="1.5" height="1.5" x="5" y="7" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="6" y="7" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="7" y="7" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="8" y="7" fill="#0B53D7" /><rect width="1.5" height="1.5" x="9" y="7" fill="#0B53D7" /><rect width="1.5" height="1.5" x="10" y="7" fill="#0B53D7" /><rect width="1.5" height="1.5" x="11" y="7" fill="#0B53D7" /><rect width="1.5" height="1.5" x="12" y="7" fill="#0B53D7" /><rect width="1.5" height="1.5" x="13" y="7" fill="#0B53D7" /><rect width="1.5" height="1.5" x="14" y="7" fill="#000000" /><rect width="1.5" height="1.5" x="15" y="7" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="0" y="8" fill="#000000" /><rect width="1.5" height="1.5" x="1" y="8" fill="#000000" /><rect width="1.5" height="1.5" x="2" y="8" fill="#000000" /><rect width="1.5" height="1.5" x="3" y="8" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="4" y="8" fill="#000000" /><rect width="1.5" height="1.5" x="5" y="8" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="6" y="8" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="7" y="8" fill="#0B53D7" /><rect width="1.5" height="1.5" x="8" y="8" fill="#0B53D7" /><rect width="1.5" height="1.5" x="9" y="8" fill="#0B53D7" /><rect width="1.5" height="1.5" x="10" y="8" fill="#0B53D7" /><rect width="1.5" height="1.5" x="11" y="8" fill="#0B53D7" /><rect width="1.5" height="1.5" x="12" y="8" fill="#0B53D7" /><rect width="1.5" height="1.5" x="13" y="8" fill="#000000" /><rect width="1.5" height="1.5" x="14" y="8" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="15" y="8" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="0" y="9" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="9" fill="#000000" /><rect width="1.5" height="1.5" x="2" y="9" fill="#F4D199" /><rect width="1.5" height="1.5" x="3" y="9" fill="#F4D199" /><rect width="1.5" height="1.5" x="4" y="9" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="5" y="9" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="6" y="9" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="7" y="9" fill="#F4D199" /><rect width="1.5" height="1.5" x="8" y="9" fill="#F4D199" /><rect width="1.5" height="1.5" x="9" y="9" fill="#0B53D7" /><rect width="1.5" height="1.5" x="10" y="9" fill="#0B53D7" /><rect width="1.5" height="1.5" x="11" y="9" fill="#0B53D7" /><rect width="1.5" height="1.5" x="12" y="9" fill="#0B53D7" /><rect width="1.5" height="1.5" x="13" y="9" fill="#0B53D7" /><rect width="1.5" height="1.5" x="14" y="9" fill="#000000" /><rect width="1.5" height="1.5" x="15" y="9" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="0" y="10" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="10" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="2" y="10" fill="#000000" /><rect width="1.5" height="1.5" x="3" y="10" fill="#F4D199" /><rect width="1.5" height="1.5" x="4" y="10" fill="#F4D199" /><rect width="1.5" height="1.5" x="5" y="10" fill="#F4D199" /><rect width="1.5" height="1.5" x="6" y="10" fill="#F4D199" /><rect width="1.5" height="1.5" x="7" y="10" fill="#F4D199" /><rect width="1.5" height="1.5" x="8" y="10" fill="#F4D199" /><rect width="1.5" height="1.5" x="9" y="10" fill="#0B53D7" /><rect width="1.5" height="1.5" x="10" y="10" fill="#0B53D7" /><rect width="1.5" height="1.5" x="11" y="10" fill="#0B53D7" /><rect width="1.5" height="1.5" x="12" y="10" fill="#0B53D7" /><rect width="1.5" height="1.5" x="13" y="10" fill="#0B53D7" /><rect width="1.5" height="1.5" x="14" y="10" fill="#0B53D7" /><rect width="1.5" height="1.5" x="15" y="10" fill="#000000" /><rect width="1.5" height="1.5" x="0" y="11" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="11" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="2" y="11" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="3" y="11" fill="#000000" /><rect width="1.5" height="1.5" x="4" y="11" fill="#F4D199" /><rect width="1.5" height="1.5" x="5" y="11" fill="#F4D199" /><rect width="1.5" height="1.5" x="6" y="11" fill="#F4D199" /><rect width="1.5" height="1.5" x="7" y="11" fill="#F4D199" /><rect width="1.5" height="1.5" x="8" y="11" fill="#000000" /><rect width="1.5" height="1.5" x="9" y="11" fill="#000000" /><rect width="1.5" height="1.5" x="10" y="11" fill="#000000" /><rect width="1.5" height="1.5" x="11" y="11" fill="#000000" /><rect width="1.5" height="1.5" x="12" y="11" fill="#000000" /><rect width="1.5" height="1.5" x="13" y="11" fill="#000000" /><rect width="1.5" height="1.5" x="14" y="11" fill="#000000" /><rect width="1.5" height="1.5" x="15" y="11" fill="#000000" /><rect width="1.5" height="1.5" x="0" y="12" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="12" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="2" y="12" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="3" y="12" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="4" y="12" fill="#000000" /><rect width="1.5" height="1.5" x="5" y="12" fill="#000000" /><rect width="1.5" height="1.5" x="6" y="12" fill="#000000" /><rect width="1.5" height="1.5" x="7" y="12" fill="#000000" /><rect width="1.5" height="1.5" x="8" y="12" fill="#F4D199" /><rect width="1.5" height="1.5" x="9" y="12" fill="#000000" /><rect width="1.5" height="1.5" x="10" y="12" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="11" y="12" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="12" y="12" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="13" y="12" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="14" y="12" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="15" y="12" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="0" y="13" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="13" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="2" y="13" fill="#000000" /><rect width="1.5" height="1.5" x="3" y="13" fill="#000000" /><rect width="1.5" height="1.5" x="4" y="13" fill="#F4D199" /><rect width="1.5" height="1.5" x="5" y="13" fill="#F4D199" /><rect width="1.5" height="1.5" x="6" y="13" fill="#0B53D7" /><rect width="1.5" height="1.5" x="7" y="13" fill="#000000" /><rect width="1.5" height="1.5" x="8" y="13" fill="#000000" /><rect width="1.5" height="1.5" x="9" y="13" fill="#F4D199" /><rect width="1.5" height="1.5" x="10" y="13" fill="#000000" /><rect width="1.5" height="1.5" x="11" y="13" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="12" y="13" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="13" y="13" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="14" y="13" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="15" y="13" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="0" y="14" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="14" fill="#000000" /><rect width="1.5" height="1.5" x="2" y="14" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="3" y="14" fill="#000000" /><rect width="1.5" height="1.5" x="4" y="14" fill="#F4D199" /><rect width="1.5" height="1.5" x="5" y="14" fill="#F4D199" /><rect width="1.5" height="1.5" x="6" y="14" fill="#000000" /><rect width="1.5" height="1.5" x="7" y="14" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="8" y="14" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="9" y="14" fill="#000000" /><rect width="1.5" height="1.5" x="10" y="14" fill="#F4D199" /><rect width="1.5" height="1.5" x="11" y="14" fill="#000000" /><rect width="1.5" height="1.5" x="12" y="14" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="13" y="14" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="14" y="14" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="15" y="14" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="0" y="15" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="1" y="15" fill="#000000" /><rect width="1.5" height="1.5" x="2" y="15" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="3" y="15" fill="#000000" /><rect width="1.5" height="1.5" x="4" y="15" fill="#F4D199" /><rect width="1.5" height="1.5" x="5" y="15" fill="#000000" /><rect width="1.5" height="1.5" x="6" y="15" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="7" y="15" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="8" y="15" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="9" y="15" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="10" y="15" fill="#000000" /><rect width="1.5" height="1.5" x="11" y="15" fill="#000000" /><rect width="1.5" height="1.5" x="12" y="15" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="13" y="15" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="14" y="15" fill="#FFFFFF" /><rect width="1.5" height="1.5" x="15" y="15" fill="#FFFFFF" /></svg>`
)

func Test_svgResizeToImageLibvips(t *testing.T) {
	type args struct {
		svgImage string
	}
	n1_output, _ := hex.DecodeString(`89504e470d0a1a0a0000000d4948445200002bc0`)
	tests := []struct {
		name string
		args args
		want []byte
	}{
		{
			name: "nCeption 1",
			args: args{nCeption1_svg},
			want: n1_output,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			// Just compare the first 20 bytes since the output is large
			if got := svgResizeToImageLibvips(tt.args.svgImage); !reflect.DeepEqual(got[0:20], tt.want[0:20]) {
				t.Errorf("svgResizeToImageLibvips() = %v, want %v", hex.EncodeToString(got[0:20]), tt.want[0:20])
			}
		})
	}
}

func Benchmark_svgResizeToImageLibvips(b *testing.B) {
	for n := 0; n < b.N; n++ {
		svgResizeToImageLibvips(chimp1_svg)
	}
}
